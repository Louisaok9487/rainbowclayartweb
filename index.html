// This declaration is necessary because AOS is loaded from a CDN.
declare const AOS: { init: (options: any) => void; };

document.addEventListener('DOMContentLoaded', () => {
    // Check if AOS is loaded before initializing
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 800, // animation duration
            once: true,    // whether animation should happen only once
        });
    }

    // --- JavaScript for Navigation ---
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    // Select all navigation links within the header to handle clicks
    const allNavLinks = document.querySelectorAll<HTMLAnchorElement>('header a[href^="#"]'); 
    const desktopNavLinks = document.querySelectorAll<HTMLAnchorElement>('nav .nav-link');
    const mobileNavLinks = document.querySelectorAll<HTMLAnchorElement>('#mobile-menu .nav-link-mobile');

    // --- Mobile Menu Toggle ---
    if (menuBtn && mobileMenu) {
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    }

    // --- Function to update active link styles ---
    const setActiveLink = (targetHref: string | null) => {
        if (!targetHref) return;

        desktopNavLinks.forEach(link => {
            if (link.getAttribute('href') === targetHref) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });

        mobileNavLinks.forEach(link => {
            if (link.getAttribute('href') === targetHref) {
                link.classList.add('font-bold', 'text-gray-900', 'bg-gray-50');
            } else {
                link.classList.remove('font-bold', 'text-gray-900', 'bg-gray-50');
            }
        });
    };

    // --- Main navigation click handler ---
    allNavLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetHref = link.getAttribute('href');
            if (!targetHref) return;
            const targetElement = document.querySelector(targetHref);

            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth'
                });
            }
            
            setActiveLink(targetHref);

            // Hide mobile menu after a click
            if (mobileMenu) {
                mobileMenu.classList.add('hidden');
            }
        });
    });

    // --- Set initial active link on page load ---
    // Check hash on load to support direct links to sections
    const currentHash = window.location.hash;
    if (currentHash) {
        setActiveLink(currentHash);
    } else {
        setActiveLink('#home');
    }
});
